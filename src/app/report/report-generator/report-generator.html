<mat-card>
  <mat-card-title align="center" style="margin: 1rem">Report Generator</mat-card-title>
  <mat-card-content>
    <form [formGroup]="reportForm" novalidate>
      <div style="display: flex">
        <mat-form-field style="width: 90%; margin: auto">
          <mat-label>Employee</mat-label>
          <mat-select
            required
            placeholder="Employee"
            formControlName="employeeId"
            (selectionChange)="onEmployeeSelectionChange($event)"
          >
            @for (employee of employees(); track $index) {
            <mat-option [value]="employee.id">
              {{ `${employee.firstName} ${employee.lastName}` }}
            </mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>

      @if (employeeExpenses().length == 0 && reportForm.get('employeeId')?.value > 0) {
      <div style="display: flex; justify-content: center; margin-top: 10px">
        <mat-card-title>No Expenses</mat-card-title>
      </div>
      } @if (employeeExpenses().length > 0) {
      <div style="display: flex">
        <mat-form-field style="width: 90%; margin: auto">
          <mat-label>Expenses</mat-label>
          <mat-select required placeholder="Expense" formControlName="expenseId">
            @for (expense of employeeExpenses(); track $index) {
            <mat-option [value]="expense.id">
              {{ expense.description }}
            </mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>
      }
    </form>

    @if(selectedExpenseId() > 0) {

    <div class="section">
      <button
        mat-raised-button
        type="button"
        style="color: green"
        (click)="addExpense()"
        [disabled]="expenseAlreadyAdded()"
      >
        Add
      </button>
      <span style="flex: 1 1 auto"></span>
      <button
        mat-raised-button
        type="button"
        style="color: red"
        (click)="removeExpense()"
        [disabled]="!expenseAlreadyAdded()"
      >
        Remove
      </button>
    </div>

    } @if (reportTable.data.length > 0) {

    <div class="section">
      <h3>Expenses In Report</h3>
    </div>

    <div class="section">
      <table mat-table [dataSource]="reportTable">
        <tr mat-header-row *matHeaderRowDef="tableColumns; sticky: true"></tr>
        <tr mat-row *matRowDef="let expense; columns: tableColumns"></tr>
        <tr mat-footer-row *matFooterRowDef="tableColumns"></tr>

        <ng-container matColumnDef="date">
          <th mat-header-cell *matHeaderCellDef>
            <div align="center">Date</div>
          </th>
          <td mat-cell *matCellDef="let expense">
            <div align="center">{{ expense.date | date : 'MM/dd/yyyy' }}</div>
          </td>
          <td mat-footer-cell *matFooterCellDef></td>
        </ng-container>

        <ng-container matColumnDef="description">
          <th mat-header-cell *matHeaderCellDef>
            <div align="center">Description</div>
          </th>
          <td mat-cell *matCellDef="let expense">
            <div align="center">{{ expense.description }}</div>
          </td>
          <td mat-footer-cell *matFooterCellDef>
            <div align="right">Total</div>
          </td>
        </ng-container>

        <ng-container matColumnDef="amount">
          <th mat-header-cell *matHeaderCellDef>
            <div align="center">Amount</div>
          </th>
          <td mat-cell *matCellDef="let expense">
            <div align="right">
              {{ expense.amount | currency : '$' }}
            </div>
          </td>
          <td mat-footer-cell *matFooterCellDef>
            <div align="right">
              <strong>
                {{ reportTotal() | currency : '$' }}
              </strong>
            </div>
          </td>
        </ng-container>
      </table>
    </div>

    <div class="section">
      <button mat-raised-button type="button" style="color: green" (click)="saveReport()">
        Save Report
      </button>
    </div>

    } @if (reportCreatedMessage() != '') {

    <div class="section">
      <h3>{{ reportCreatedMessage() }}</h3>
    </div>

    }
  </mat-card-content>
</mat-card>
