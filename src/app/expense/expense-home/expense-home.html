<mat-card>
  @if (hasSelectedExpense()) {
  <mat-card-title align="center" style="margin: 1rem">
    {{ this.newExpense() ? 'New Expense' : 'Expense Details' }}
  </mat-card-title>

  <mat-card-content>
    <app-expense-details
      [employees]="employees()"
      [expense]="expenseInDetail()"
      (saved)="saveExpense($event)"
      (deleted)="deleteExpense($event)"
      (closed)="refresh()"
    />
  </mat-card-content>
  } @else {
  <mat-card-title align="center" style="margin: 1rem">Expenses</mat-card-title>
  <mat-card-content>
    <!-- MODIFIED: Added style="width: 100%" to ensure table fills card width -->
    <table
      mat-table
      [dataSource]="expensesTable"
      matSort
      matSortActive="id"
      matSortDirection="asc"
      matSortDisableClear
      (matSortChange)="sortExpenses($event)"
      style="width: 100%"
    >
      <tr mat-header-row *matHeaderRowDef="tableColumns; sticky: true"></tr>

      <tr
        mat-row
        *matRowDef="let expense; columns: tableColumns"
        (click)="selectExpense(expense)"
      ></tr>

      <!-- ID Column -->
      <ng-container matColumnDef="id">
        <!-- REMOVED <div align="center"> -->
        <th mat-header-cell *matHeaderCellDef mat-sort-header>ID</th>
        <!-- REMOVED <div align="center"> -->
        <td mat-cell *matCellDef="let expense">
          {{ expense.id }}
        </td>
      </ng-container>

      <!-- Date Column -->
      <ng-container matColumnDef="date">
        <!-- REMOVED <div align="center"> -->
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Date</th>
        <!-- REMOVED <div align="center"> -->
        <td mat-cell *matCellDef="let expense">
          {{ expense.date | date : 'shortDate' }}
        </td>
      </ng-container>

      <!-- Employee Column -->
      <ng-container matColumnDef="employeeId">
        <!-- REMOVED <div align="center"> -->
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Employee</th>
        <!-- REMOVED <div align="center"> -->
        <td mat-cell *matCellDef="let expense">
          {{
            `[#${expense.employeeId}] ${
              employeeOfId(expense.employeeId)?.lastName ?? 'N/A'
            }`
          }}
        </td>
      </ng-container>
    </table>
  </mat-card-content>
  }
</mat-card>

@if (!hasSelectedExpense()) {
<mat-icon (click)="addNewExpense()" matTooltip="Add New Expense" class="addicon" color="primary">
  control_point</mat-icon
>
}
